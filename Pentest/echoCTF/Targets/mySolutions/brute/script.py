import subprocess
import time

def comando(myPass):
    # Comando para conectarse al servidor usando netcat
    command = ["nc", "10.0.14.16", "1337"]

    # Inicia el proceso de netcat
    process = subprocess.Popen(command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)

    # Envía el usuario
    process.stdin.write("root\n")
    process.stdin.flush()  # Asegura que los datos se envíen
    time.sleep(0.2)  # Espera 200 milisegundos para que el servidor procese el usuario

    # Envía la contraseña
    process.stdin.write(f"{myPass}\n")
    process.stdin.flush()  # Asegura que los datos se envíen

    # Cierra la entrada estándar para finalizar la comunicación
    process.stdin.close()

    # Acumula toda la salida del servidor en una variable
    salida_completa = ""
    password = ""
    while True:
        output = process.stdout.read(1)  # Lee la salida carácter por carácter
        if output == '' and process.poll() is not None:
            break
        if output:
            print(output, end='')  # Imprime la salida en tiempo real
            salida_completa += output

    # Busca y extrae el texto después de "Random password: "
    start_marker = "Random password: "
    start_index = salida_completa.find(start_marker)
    if start_index != -1:
        start_index += len(start_marker)
        # Extrae la contraseña (hasta el primer espacio o el final de la línea)
        password = salida_completa[start_index:].split()[0].strip()  # Lee hasta el primer espacio y elimina espacios adicionales

    return password

# Llama a la función con una contraseña de ejemplo
myPass = comando("algo")
print(f"[{myPass}]")
myPass2 = comando(myPass)
